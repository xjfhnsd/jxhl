!function(){"use strict";function $jxhl(){this.useCache=!1,this.layoutCache={}}$jxhl.prototype.newControl=function(node,baseid){var basecontrol=document.createElement("div");if(node){if(basecontrol.setAttribute("jxhl_control",node.nodeName),basecontrol.setAttribute("jxhl_baseid",baseid),node.getAttribute("id")&&(basecontrol.id=baseid+"_"+node.getAttribute("id")),node.getAttribute("css_name")&&(basecontrol.className=node.getAttribute("css_name")),node.getAttribute("css_text")&&(basecontrol.style.cssText=node.getAttribute("css_text")),node.getAttribute("width")&&(basecontrol.jxhlWidth=parseInt(node.getAttribute("width"))),node.getAttribute("height")&&(basecontrol.jxhlHeight=parseInt(node.getAttribute("height"))),basecontrol.jxhlLeft=node.getAttribute("left")?parseInt(node.getAttribute("left")):0,basecontrol.jxhlTop=node.getAttribute("top")?parseInt(node.getAttribute("top")):0,basecontrol.dock=node.getAttribute("dock")?node.getAttribute("dock"):"auto",basecontrol.overflow=node.getAttribute("overflow")?node.getAttribute("overflow"):"hidden",basecontrol.v_align=node.getAttribute("v_align")?node.getAttribute("v_align"):"top",basecontrol.h_align=node.getAttribute("h_align")?node.getAttribute("h_align"):"left",basecontrol.visible=node.getAttribute("visible")?this.toBoolean(node.getAttribute("visible")):!0,node.getAttribute("opacity")){var opaF=1;try{opaF=Math.min(1,parseFloat(node.getAttribute("opacity")))}catch(x){}basecontrol.style.opacity=opaF,basecontrol.style.mozOpacity=opaF,basecontrol.style.khtmlOpacity=opaF,basecontrol.style.filter="alpha(opacity="+parseInt(100*opaF)+")"}var margin=node.getAttribute("margin"),padding=node.getAttribute("padding"),border=node.getAttribute("border_width");if(basecontrol.margin=margin?-1==margin.indexOf(",")?[parseInt(margin),parseInt(margin),parseInt(margin),parseInt(margin)]:eval("(["+margin+"])"):[0,0,0,0],basecontrol.padding=padding?-1==padding.indexOf(",")?[parseInt(padding),parseInt(padding),parseInt(padding),parseInt(padding)]:eval("(["+padding+"])"):[0,0,0,0],basecontrol.border=border?-1==border.indexOf(",")?[parseInt(border),parseInt(border),parseInt(border),parseInt(border)]:eval("(["+border+"])"):[0,0,0,0],basecontrol.style.borderTopWidth=basecontrol.border[0]+"px",basecontrol.style.borderRightWidth=basecontrol.border[1]+"px",basecontrol.style.borderBottomWidth=basecontrol.border[2]+"px",basecontrol.style.borderLeftWidth=basecontrol.border[3]+"px","image"==node.nodeName){var img=document.createElement("img");node.getAttribute("src")&&img.setAttribute("src",node.getAttribute("src")),basecontrol.jxhl_image=img,basecontrol.appendChild(img)}if("frame"==node.nodeName){var frm=document.createElement("iframe");frm.frameBorder=0,frm.frameSpacing=0,node.getAttribute("frame_scrolling")?frm.setAttribute("scrolling",node.getAttribute("frame_scrolling")):frm.setAttribute("scrolling","auto"),node.getAttribute("src")&&frm.setAttribute("src",node.getAttribute("src")),basecontrol.jxhl_frame=frm,basecontrol.appendChild(frm)}node.getAttribute("local_var")&&"jxhl$runnable"!=node.getAttribute("local_var")&&"jxhl$container"!=node.getAttribute("local_var")&&"jxhl$arguments"!=node.getAttribute("local_var")&&(this.runnableObject["jxhl_inner_var$"+baseid][node.getAttribute("local_var")]=basecontrol)}return basecontrol},$jxhl.prototype.parseControl=function(e,t,r){function n(){var e=arguments[0];if(1==e.nodeType){e.getAttribute("local_var")&&"jxhl$runnable"!=e.getAttribute("local_var")&&"jxhl$container"!=e.getAttribute("local_var")&&"jxhl$arguments"!=e.getAttribute("local_var")&&(this.runnableObject["jxhl_inner_var$"+r][e.getAttribute("local_var")]=e);var t=e.childNodes;if(0!=t.length)for(var o=0;o<t.length;o++)n.apply(this,[t[o]])}}if(4!=e.nodeType&&3!=e.nodeType&&8!=e.nodeType){var o=e.nodeName;if("runnable"==o)return void(this.runnableObject["jxhl_inner_var$"+r].jxhl$runnable=this.getInnerHtml(e));t.childControls||(t.childControls=[]);var i=this.newControl(e,r);switch(i.style.position="absolute",i.isroot=!1,i.parentContainer=t,o){case"html":case"label":if("undefined"!=typeof jQuery?$(i).append(this.getInnerHtml(e)):i.innerHTML=this.getInnerHtml(e),t.appendChild(i),t.childControls.push(i),"html"==o)for(var a=i.childNodes,l=0;l<a.length;l++)n.apply(this,[a[l]]);break;case"frame":t.appendChild(i),t.childControls.push(i);break;case"image":t.appendChild(i),t.childControls.push(i);break;case"panel":t.appendChild(i),t.childControls.push(i)}if("panel"==o&&e.childNodes.length>0)for(var s=0;s<e.childNodes.length;s++)this.parseControl(e.childNodes[s],i,r)}},$jxhl.prototype.calcControlPostion=function(e){if(e.parentContainer){if(!e.visible)return e.style.display="none",void(e.jxhl_runtime_visible="disable");e.jxhl_runtime_visible&&"disable"==e.jxhl_runtime_visible&&(e.jxhl_runtime_visible=null,e.style.display="");var t=e.parentContainer,r=this.calcElementSize(t);t.region||(t.region={sx:0,sy:0,ex:r.width,ey:r.height});var n=this.calcElementSize(e),o=0,i=0;switch(e.style.position="absolute",e.dock){case"auto":o=n.width-e.margin[1]-e.margin[3]-e.border[1]-e.border[3],i=n.height-e.margin[0]-e.margin[2]-e.border[0]-e.border[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.position="relative",e.style.left=e.jxhlLeft+e.margin[3]+"px",e.style.top=e.jxhlTop+e.margin[0]+"px";break;case"none":o=n.width-e.margin[1]-e.margin[3]-e.border[1]-e.border[3],i=n.height-e.margin[0]-e.margin[2]-e.border[0]-e.border[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:0,ey:0},e.style.position="relative",e.jxhlWidth&&(e.style.width=o+"px"),e.jxhlHeight&&(e.style.height=i+"px"),e.style.left=e.jxhlLeft+e.margin[3]+"px",e.style.top=e.jxhlTop+e.margin[0]+"px";break;case"top":o=t.region.ex-t.region.sx-e.margin[1]-e.margin[3],i=n.height-e.margin[0]-e.margin[2]-e.border[0]-e.border[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left=t.region.sx+e.margin[3]+"px",e.style.top=t.region.sy+e.margin[0]+"px",t.region.sy+=n.height;break;case"bottom":o=t.region.ex-t.region.sx-e.margin[1]-e.margin[3],i=n.height-e.margin[0]-e.margin[2]-e.border[0]-e.border[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left=t.region.sx+e.margin[3]+"px",e.style.top=t.region.ey-n.height+e.margin[0]+"px",t.region.ey-=n.height;break;case"left":o=n.width-e.margin[1]-e.margin[3]-e.border[1]-e.border[3],i=t.region.ey-t.region.sy-e.margin[0]-e.margin[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left=t.region.sx+e.margin[3]+"px",e.style.top=t.region.sy+e.margin[0]+"px",t.region.sx+=n.width;break;case"right":o=n.width-e.margin[1]-e.margin[3]-e.border[1]-e.border[3],i=t.region.ey-t.region.sy-e.margin[0]-e.margin[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left=t.region.ex-n.width+e.margin[3]+"px",e.style.top=t.region.sy+e.margin[0]+"px",t.region.ex-=n.width;break;case"fill":o=t.region.ex-t.region.sx-e.margin[1]-e.margin[3],i=t.region.ey-t.region.sy-e.margin[0]-e.margin[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left=t.region.sx+e.margin[3]+"px",e.style.top=t.region.sy+e.margin[0]+"px",t.region.sx=t.region.ex,t.region.sy=t.region.ey;break;case"fix":o=r.width-t.margin[1]-t.margin[3],i=r.height-t.margin[0]-t.margin[2],o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left="0px",e.style.top="0px";break;case"center":o=Math.min(n.width-e.margin[1]-e.margin[3]-e.border[1]-e.border[3],t.region.ex-t.region.sx-e.margin[1]-e.margin[3]),i=Math.min(n.height-e.margin[0]-e.margin[2]-e.border[0]-e.border[2],t.region.ey-t.region.sy-e.margin[0]-e.margin[2]),o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.style.width=o+"px",e.style.height=i+"px",e.style.left=t.region.sx+parseInt((t.region.ex-t.region.sx-o)/2)+"px",e.style.top=t.region.sy+parseInt((t.region.ey-t.region.sy-i)/2)+"px",t.region.sx=t.region.ex,t.region.sy=t.region.ey;break;case"float":o=n.width,i=n.height,o=Math.max(o,0),i=Math.max(i,0),e.region={sx:0,sy:0,ex:o,ey:i},e.jxhlWidth&&(e.style.width=o+"px"),e.jxhlHeight&&(e.style.height=i+"px"),e.style.position="relative",e.style["float"]="left",e.style.styleFloat="left",e.style.cssFloat="left"}e.jxhl_frame&&(e.jxhl_frame.style.width=o+"px",e.jxhl_frame.style.height=i+"px")}if(e.childControls)for(var a=0;a<e.childControls.length;a++)this.calcControlPostion(e.childControls[a])},$jxhl.prototype.calcElementSize=function(e){var t=e.jxhlWidth||0,r=e.jxhlHeight||0;return"undefined"!=typeof jQuery?(t=Math.max(t,$(e).outerWidth()),r=Math.max(r,$(e).outerHeight()),{width:t,height:r}):(t=Math.max(e.offsetWidth||0,e.clientWidth||0,t),e==document.body&&(t=Math.max(t,document.documentElement.clientWidth||0,document.documentElement.offsetWidth||0,document.documentElement.scrollWidth||0,document.body.clientWidth||0,document.body.offsetWidth||0,document.body.scrollWidth||0)),r=Math.max(e.offsetHeight||0,e.clientHeight||0,r),e.border&&!e.hasCalcBorder&&(r=r-Math.max(e.border[0],0)-Math.max(e.border[2],0),t=t-Math.max(e.border[1],0)-Math.max(e.border[3],0),e.hasCalcBorder=!0),e==document.body&&(r=Math.max(r,document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0,document.documentElement.scrollHeight||0,document.body.clientHeight||0,document.body.offsetHeight||0,document.body.scrollHeight||0)),{width:t,height:r})},$jxhl.prototype.clearControlRegion=function(e){if(e.region=null,e.childControls)for(var t=0;t<e.childControls.length;t++)this.clearControlRegion(e.childControls[t])},$jxhl.prototype.clearChildControls=function(e){e.childControls&&(e.childControls=null)},$jxhl.prototype.toBoolean=function(e){if("string"==typeof e)switch(e.toLowerCase()){case"1":case"on":case"yes":case"true":return!0;default:return!1}return!!e},$jxhl.prototype.handleError=function(e,t){alert(e)},$jxhl.prototype.xmlhttp=function(){return"undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},$jxhl.prototype.loadXml=function(e,t,r,n){var o=this;if(this.useCache&&this.layoutCache[e])return void o.initComplete(this.layoutCache[e],t,r,n);if("undefined"!=typeof jQuery)return void $.ajax({url:e,type:"GET",dataType:"text",timeout:6e4,error:function(t){o.handleError("unable to load file "+e+" : "+t)},success:function(i){var a=o.loadXmlFromString(i);o.useCache&&(o.layoutCache[e]=a),o.initComplete(a,t,r,n)}});var i=this.xmlhttp();i.open("GET",e,!0),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){if(("undefined"==typeof i.responseXML||"object"!=typeof i.responseXML)&&"undefined"!=typeof DOMParser&&DOMParser&&i.responseText){var a=new DOMParser,l=a.parseFromString(i.responseText,"text/xml");return o.useCache&&(o.layoutCache[e]=l),void o.initComplete(l,t,r,n)}return i.responseXML?(o.useCache&&(o.layoutCache[e]=i.responseXML),void o.initComplete(i.responseXML,t,r,n)):o.handleError("unable to load file "+e+" : invalid xml format")}},i.send("")},$jxhl.prototype.loadXmlFromString=function(e){if(!e)return null;if("undefined"!=typeof DOMParser&&DOMParser){var t=new DOMParser,r=t.parseFromString(e,"text/xml");return r}try{var r=new ActiveXObject("MSXML2.DOMDocument");return r.loadXML(e),r}catch(n){return null}},$jxhl.prototype.getInnerHtml=function(e){function t(e){try{var t=e.text;if(t)return t}catch(r){}try{var t=e.textContent;if(t)return t}catch(r){}for(var n=[],o=e.childNodes,i=0;i<o.length;i++){var a=o.item(i);n[n.length]=a.nodeValue}return n.join("")}function r(e){var t=[],r=e.childNodes;if("xml"in e)for(var n=0;n<r.length;n++)t[n]=r.item(n).xml;else if("undefined"!=typeof XMLSerializer)for(var o=new XMLSerializer,n=0;n<r.length;n++){var i=r[n];t[t.length]=1==i.nodeType?o.serializeToString(i):i.nodeValue}return t.join("")}var n;return n=this.toBoolean(e.getAttribute("rawhtml"))?t(e):r(e),n=n.replace(/(^\s+|\s+$)/g,""),n=n.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,"")},$jxhl.prototype.getElement=function(e,t){if(!t||!e)return null;var r=null;return"undefined"!=typeof t&&t&&(r="string"==typeof t?document.getElementById(t):t),r&&r.id?document.getElementById(r.id+"_"+e):null},$jxhl.prototype.notifyResize=function(e){if("undefined"!=typeof e){var t="string"==typeof e?document.getElementById(e):e;t&&(this.clearControlRegion(t),this.calcControlPostion(t))}},$jxhl.prototype.monitorElement=function(e){function t(){if(!e)return void(n&&(clearInterval(n),n=null));if(!e.visible||"none"==e.style.display)return void("none"==e.style.display);if(!e.oldSize)return void(e.oldSize=o.calcElementSize(e));var i=o.calcElementSize(e);if(i.width!=e.oldSize.width||i.height!=e.oldSize.height){if(r)return clearInterval(n),r=!1,void(n=setInterval(t,100));r=!0;var a=e.isroot?e:e.parentContainer;o.notifyResize(a),a.oldSize=i,r=!1}}var r=!1,n=null,o=this;n=setInterval(t,100)},$jxhl.prototype.buildRunnable=function(baseid){function _run(){var localvar_names=[],localvar_evals=[];for(var n in self.runnableObject["jxhl_inner_var$"+baseid])"jxhl$runnable"!=n&&localvar_evals.push("var "+n+"=self.runnableObject['jxhl_inner_var$"+baseid+"']['"+n+"'];"),-1==n.indexOf("jxhl$")&&localvar_names.push(n);var runnableFunc="new function(){ \r\n                "+localvar_evals.join("")+"\r\n                var jxhl$localVars = ["+localvar_names.join(",")+"]; \r\n                "+self.runnableObject["jxhl_inner_var$"+baseid].jxhl$runnable+" \r\n                }();";try{eval(runnableFunc)}catch(x){alert("runnable node parse error : "+x.message)}}if(this.runnableObject&&this.runnableObject["jxhl_inner_var$"+baseid]&&this.runnableObject["jxhl_inner_var$"+baseid].jxhl$runnable){var self=this;_run()}},$jxhl.prototype.init=function(e,t,r,n,o){var i=document.body;if("undefined"!=typeof t&&t&&(i="string"==typeof t?document.getElementById(t)||document.body:t),i.id||(i.id="_jxhl_autoid_"+(new Date).getTime()),i.style.position||(i.style.position="relative"),i.visible=!0,i.isroot=!0,i.margin=[0,0,0,0],!e)return void this.handleError("xml file path is null");var a;r&&"text"==r?(e.indexOf("<")>0&&(e=e.substr(1)),a=this.loadXmlFromString(e),this.initComplete(a,i,n,o)):this.loadXml(e,i,n,o)},$jxhl.prototype.initComplete=function(e,t,r,n){if(e){this.clearChildControls(t),this.clearControlRegion(t),t.innerHTML="",this.runnableObject||(this.runnableObject={}),this.runnableObject["jxhl_inner_var$"+t.id]={},this.runnableObject["jxhl_inner_var$"+t.id].jxhl$container=t,this.runnableObject["jxhl_inner_var$"+t.id].jxhl$arguments=r;var o=e.documentElement||e;o=o.cloneNode(!0);for(var i=0;i<o.childNodes.length;i++)this.parseControl(o.childNodes[i],t,t.id);this.calcControlPostion(t),this.monitorElement(t),this.buildRunnable(t.id),"function"==typeof n&&n()}},$jxhl.prototype.extension=function(e){"function"==typeof e&&e.apply(this,null)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return $jxhl()}):"undefined"!=typeof module&&module.exports?(module.exports=new $jxhl,module.exports.jxhl=$jxhl):window.jxhl||(window.jxhl=new $jxhl)}();